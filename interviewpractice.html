<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="meta_title">한국어 말하기 연습 앱</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .grammar-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .grammar-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app-container" class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Header -->
        <header class="mb-8 p-6 bg-white rounded-xl shadow-md">
            <div class="flex flex-col sm:flex-row justify-between items-center">
                <div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-blue-600" data-lang-key="app_title">유학생을 위한 한국어 말하기 시험 완벽 대비</h1>
                    <p class="mt-1 text-gray-500" data-lang-key="app_subtitle">나의 경험을 통해 미래 계획 세우기</p>
                </div>
                <div class="mt-4 sm:mt-0">
                    <select id="language-selector" class="block w-full sm:w-auto p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="ko">한국어</option>
                        <option value="en">English</option>
                        <option value="vi">Tiếng Việt</option>
                        <option value="ja">日本語</option>
                        <option value="zh">中文</option>
                    </select>
                </div>
            </div>
        </header>

        <main id="main-content">
            <!-- Sections will be dynamically generated here -->
        </main>
    </div>

    <!-- Floating Action Buttons -->
    <div id="fab-container" class="fixed bottom-6 right-6 flex flex-col space-y-3">
        <button id="save-button" class="bg-blue-600 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center hover:bg-blue-700 transition-transform transform hover:scale-110" title="Save progress">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V7l-4-4z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M7 3v6h10V3" />
            </svg>
        </button>
        <button id="capture-button" class="bg-green-600 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center hover:bg-green-700 transition-transform transform hover:scale-110" title="Capture as image">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
        </button>
    </div>

    <!-- Custom Alert Modal -->
    <div id="save-notification" class="hidden fixed top-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-xl transition-opacity duration-300">
        <p data-lang-key="saved_message">내용이 저장되었습니다!</p>
    </div>

<script>
    const translations = {
        ko: {
            meta_title: "한국어 말하기 연습 앱",
            app_title: "유학생을 위한 한국어 말하기 시험 완벽 대비",
            app_subtitle: "나의 경험을 통해 미래 계획 세우기",
            step1_title: "1단계: 나의 과거 돌아보기",
            step1_desc: "먼저, 여러분의 목표와 관련된 과거의 경험을 떠올려 보세요.",
            q1_title: "질문 1: 목표를 위해 과거에 꾸준히 했던 일이나 습관이 있나요?",
            q1_grammar: "추천 문법: V-던",
            q1_desc: "과거에 자주, 그리고 계속했던 일을 말할 때 사용해요. 'I used to...'와 비슷한 느낌이에요. 지금은 하지 않는 일을 추억하며 말할 때 자연스러워요.",
            q1_ex1: "예문 1: 제가 유학을 준비하던 시절에는 매일 새벽 5시에 일어나서 한국어 뉴스를 듣곤 했어요.",
            q1_ex2: "예문 2: 대학교 때 같이 공부하던 친구는 지금 한국 대기업에 다니고 있어요.",
            q2_title: "질문 2: 그 노력 덕분에 지금 무엇이 달라졌나요?",
            q2_grammar1: "추천 문법: V-았더니/었더니",
            q2_desc1: "'어떤 행동을 했어요. 그랬더니 이런 결과가 나타났어요.' 라고 말할 때 사용해요. 앞에 한 행동 때문에 생긴 새로운 사실이나 결과를 알려줄 때 좋아요.",
            q2_ex1: "예문 1: 꾸준히 운동을 했더니 몸이 좋아졌어요.",
            q2_grammar2: "추천 문법: 얼마나 A-(으)ㄴ/V-는지 모르다",
            q2_desc2: "'정말', '아주 많이'를 강조하고 싶을 때 사용해요. 'You have no idea how...'라는 느낌으로, 강한 감정을 표현할 수 있어요.",
            q2_ex2: "예문 2: 지난 학기에 너무 잠을 안 잤더니 시험 끝나고 얼마나 피곤했는지 몰라요.",
            q3_title: "질문 3: 그때 다르게 행동했다면 더 좋았을까요? 후회되는 일이 있나요?",
            q3_grammar: "추천 문법: A/V-았어야/었어야 했는데",
            q3_desc: "과거에 하지 않은 일에 대해 후회하거나 아쉬워할 때 사용해요. 'I should have done that, but I didn't...' 이런 마음을 표현해요.",
            q3_ex1: "예문 1: 그때 좀 더 열심히 공부했어야 했는데 (지금 성적이 안 좋아서 후회돼요).",
            q3_ex2: "예문 2: 면접 때 그 질문에 사실대로 말했어야 했는데 (괜히 거짓말을 해서 후회됩니다).",
            step2_title: "2단계: 현재와 미래 계획하기",
            step2_desc: "이제 현재의 나를 살펴보고, 미래를 계획해 봅시다.",
            q4_title: "질문 4: 지금 목표에 얼마나 가까워졌나요? 앞으로의 구체적인 계획은 무엇인가요?",
            q4_grammar1: "추천 문법: V-(으)려면 멀었다",
            q4_desc1: "내가 원하는 목표나 결과까지 아직 시간이 많이 필요하고, 더 노력해야 할 때 사용해요. 'It's a long way to go before...' 라는 의미예요.",
            q4_ex1: "예문 1: 유학을 가려면 장학금을 받아야 하는데 아직 멀었어요.",
            q4_grammar2: "추천 문법: V-(으)ㄹ 생각[계획, 예정]이다",
            q4_desc2: "미래에 무엇을 할 것인지 나의 의지나 계획을 말할 때 사용해요. '생각이다', '계획이다', '예정이다' 모두 사용할 수 있어요.",
            q4_ex2: "예문 2: 내년에 대기업에 취직하기 위해 이력서를 작성할 계획입니다.",
            q5_title: "질문 5: 주변 사람들은 노력하는 나를 어떻게 볼까요? (추측해 보세요)",
            q5_grammar: "추천 문법: A-(으)ㄴ 모양이다, V-는 모양이다, N인 모양이다",
            q5_desc: "다른 사람의 행동이나 상황을 보고 '그런 것 같아요'라고 추측할 때 사용해요. 'It seems like...' 또는 'It looks like...' 와 비슷해요.",
            q5_ex1: "예문 1: 제가 매일 밤늦게까지 공부하는 것을 보니 부모님은 제가 힘든 모양이다라고 생각하실 거예요.",
            q5_ex2: "예문 2: 팀원들이 저를 자주 도와주는 것을 보니 제가 일이 서툰 모양입니다.",
            step3_title: "3단계: 목표를 위해 준비하기",
            step3_desc: "마지막으로, 목표를 이루기 위해 필요한 것과 걱정되는 점을 이야기해 봅시다.",
            q6_title: "질문 6: 목표를 이루기 위해 꼭 해야 하는 것은 무엇인가요?",
            q6_grammar1: "추천 문법: A/V-아야/어야/여야",
            q6_desc1: "뒤에 오는 결과를 위해 반드시 필요한 조건을 말할 때 사용해요. 'You must do A to do B' 라는 의미예요.",
            q6_ex1: "예문 1: 한국에서 성공하려면 한국 문화에 대한 깊은 이해가 있어야 합니다.",
            q6_grammar2: "추천 문법: V-도록",
            q6_desc2: "뒤에 오는 행동의 목적이나 이유를 설명할 때 사용해요. 'I did this so that...' 이라고 생각하면 쉬워요.",
            q6_ex2: "예문 2: 다음 주 프레젠테이션을 잘하도록 밤새서 자료를 준비했어요.",
            q7_title: "질문 7: 목표를 이루는 과정에서 무엇이 가장 걱정되고, 어떻게 대비하고 있나요?",
            q7_grammar1: "추천 문법: A/V-(으)ㄹ까 봐",
            q7_desc1: "안 좋은 일이 생길 것 같아서 미리 걱정될 때 사용해요. 그래서 보통 뒤에는 그 걱정 때문에 어떤 행동을 했는지 함께 말해요.",
            q7_ex1: "예문 1: 면접에서 실수를 할까 봐 걱정돼서 면접 연습을 여러 번 했어요.",
            q7_grammar2: "추천 문법: 무엇이든지 / 무슨 N(이)든지",
            q7_desc2: "선택에 상관없이 'any' 또는 'no matter what' 이라는 의미예요. 어떤 것이든 괜찮거나, 모든 것을 다 하겠다는 의지를 보여줄 때 사용할 수 있어요.",
            q7_ex2: "예문 2: 성공을 위해 무엇이든지 도와 달라고 선배에게 부탁했습니다.",
            practice_placeholder: "여기에 연습 문장을 작성해 보세요...",
            saved_message: "내용이 저장되었습니다!"
        },
        en: {
            meta_title: "Korean Speaking Practice App",
            app_title: "Perfect Korean Speaking Test Prep for International Students",
            app_subtitle: "Planning the Future Through My Experiences",
            step1_title: "Step 1: Looking Back at My Past",
            step1_desc: "First, let's recall past experiences related to your goals.",
            q1_title: "Question 1: What did you consistently do or what habits did you have in the past for your goal?",
            q1_grammar: "Recommended Grammar: V-던",
            q1_desc: "Used when talking about things you often and continuously did in the past. It has a similar feel to 'I used to...'. It's natural when reminiscing about things you don't do anymore.",
            q1_ex1: "Example 1: When I was preparing to study abroad, I remember waking up at 5 AM every day to listen to Korean news.",
            q1_ex2: "Example 2: A friend I used to study with in university now works at a large Korean corporation.",
            q2_title: "Question 2: Thanks to those efforts, what has changed now?",
            q2_grammar1: "Recommended Grammar: V-았더니/었더니",
            q2_desc1: "Used when you say, 'I did something, and as a result, this happened.' It's good for explaining a new fact or result caused by a past action.",
            q2_ex1: "Example 1: I exercised consistently, and as a result, my body got healthier.",
            q2_grammar2: "Recommended Grammar: 얼마나 A-(으)ㄴ/V-는지 모르다",
            q2_desc2: "Use this to emphasize 'really' or 'very much'. It has a feeling of 'You have no idea how...' and can express strong emotions.",
            q2_ex2: "Example 2: I didn't sleep much last semester, so you have no idea how tired I was after the exams.",
            q3_title: "Question 3: Would it have been better if you had acted differently then? Is there anything you regret?",
            q3_grammar: "Recommended Grammar: A/V-았어야/었어야 했는데",
            q3_desc: "Used to express regret or sorrow about something you didn't do in the past. It expresses the sentiment of 'I should have done that, but I didn't...'.",
            q3_ex1: "Example 1: I should have studied harder back then (I regret it because my grades aren't good now).",
            q3_ex2: "Example 2: I should have told the truth to that question during the interview (I regret lying).",
            step2_title: "Step 2: Planning the Present and Future",
            step2_desc: "Now, let's examine the present and plan for the future.",
            q4_title: "Question 4: How close are you to your goal now? What are your specific plans for the future?",
            q4_grammar1: "Recommended Grammar: V-(으)려면 멀었다",
            q4_desc1: "Used when you still need a lot of time and effort to reach your desired goal. It means 'It's a long way to go before...'.",
            q4_ex1: "Example 1: I need to get a scholarship to study abroad, but I still have a long way to go.",
            q4_grammar2: "Recommended Grammar: V-(으)ㄹ 생각[계획, 예정]이다",
            q4_desc2: "Used to state your intention or plan for the future. You can use '생각이다' (think of), '계획이다' (plan to), or '예정이다' (am scheduled to).",
            q4_ex2: "Example 2: I plan to write my resume to get a job at a large company next year.",
            q5_title: "Question 5: What do people around you think of you as you strive for your goal? (Make a guess)",
            q5_grammar: "Recommended Grammar: A-(으)ㄴ 모양이다, V-는 모양이다, N인 모양이다",
            q5_desc: "Used when you guess 'it seems like...' based on someone's actions or a situation. Similar to 'It seems like...' or 'It looks like...'.",
            q5_ex1: "Example 1: Seeing me study late every night, my parents probably think it must be hard for me.",
            q5_ex2: "Example 2: Seeing my team members help me often, it seems I'm not very skilled at my work.",
            step3_title: "Step 3: Preparing for the Goal",
            step3_desc: "Finally, let's talk about what's necessary and what worries you have in achieving your goal.",
            q6_title: "Question 6: What are the essential conditions to achieve your goal?",
            q6_grammar1: "Recommended Grammar: A/V-아야/어야/여야",
            q6_desc1: "Used to state a necessary condition for the following result. It means 'You must do A to do B'.",
            q6_ex1: "Example 1: To succeed in Korea, you must have a deep understanding of Korean culture.",
            q6_grammar2: "Recommended Grammar: V-도록",
            q6_desc2: "Used to explain the purpose or reason for the following action. It's easy to think of it as 'I did this so that...'.",
            q6_ex2: "Example 2: I stayed up all night preparing materials to do well in next week's presentation.",
            q7_title: "Question 7: What are you most worried about in the process of achieving your goal, and how are you preparing for it?",
            q7_grammar1: "Recommended Grammar: A/V-(으)ㄹ까 봐",
            q7_desc1: "Used when you're worried that something bad might happen. It's often followed by an action you took because of that worry.",
            q7_ex1: "Example 1: I was worried I might make a mistake in the interview, so I practiced for it several times.",
            q7_grammar2: "Recommended Grammar: 무엇이든지 / 무슨 N(이)든지",
            q7_desc2: "Means 'any' or 'no matter what', regardless of the choice. It can be used to show that anything is fine or to express a will to do everything.",
            q7_ex2: "Example 2: I asked my senior to help me with anything for my success.",
            practice_placeholder: "Write your practice sentences here...",
            saved_message: "Content saved successfully!"
        },
        vi: {
            meta_title: "Ứng dụng Luyện nói Tiếng Hàn",
            app_title: "Luyện thi nói Tiếng Hàn hoàn hảo cho du học sinh",
            app_subtitle: "Lập kế hoạch tương lai qua kinh nghiệm của bản thân",
            step1_title: "Bước 1: Nhìn lại quá khứ",
            step1_desc: "Đầu tiên, hãy nghĩ về những kinh nghiệm trong quá khứ liên quan đến mục tiêu của bạn.",
            q1_title: "Câu hỏi 1: Bạn đã có thói quen hoặc việc làm đều đặn nào trong quá khứ để đạt được mục tiêu chưa?",
            q1_grammar: "Ngữ pháp đề xuất: V-던",
            q1_desc: "Sử dụng khi nói về việc đã làm thường xuyên và liên tục trong quá khứ. Cảm giác tương tự như 'I used to...'. Tự nhiên khi nói về việc không còn làm nữa như một kỷ niệm.",
            q1_ex1: "Ví dụ 1: Thời còn chuẩn bị du học, tôi nhớ đã từng ngày nào cũng dậy lúc 5 giờ sáng để nghe tin tức tiếng Hàn.",
            q1_ex2: "Ví dụ 2: Người bạn từng học cùng thời đại học bây giờ đang làm việc tại một tập đoàn lớn của Hàn Quốc.",
            q2_title: "Câu hỏi 2: Nhờ nỗ lực đó, bây giờ có gì thay đổi không?",
            q2_grammar1: "Ngữ pháp đề xuất: V-았더니/었더니",
            q2_desc1: "Sử dụng khi nói 'Tôi đã làm một hành động. Và kết quả là...'. Thích hợp để thông báo một sự thật hoặc kết quả mới phát sinh do hành động trước đó.",
            q2_ex1: "Ví dụ 1: Tôi đã tập thể dục đều đặn nên cơ thể đã khỏe hơn.",
            q2_grammar2: "Ngữ pháp đề xuất: 얼마나 A-(으)ㄴ/V-는지 모르다",
            q2_desc2: "Sử dụng khi muốn nhấn mạnh 'thực sự', 'rất nhiều'. Mang cảm giác 'Bạn không biết là...đến mức nào đâu', có thể biểu đạt cảm xúc mạnh mẽ.",
            q2_ex2: "Ví dụ 2: Học kỳ trước tôi đã không ngủ nhiều nên sau khi thi xong, bạn không biết tôi đã mệt đến mức nào đâu.",
            q3_title: "Câu hỏi 3: Nếu lúc đó hành động khác đi thì có tốt hơn không? Có việc gì bạn hối tiếc không?",
            q3_grammar: "Ngữ pháp đề xuất: A/V-았어야/었어야 했는데",
            q3_desc: "Sử dụng khi hối tiếc hoặc tiếc nuối về việc đã không làm trong quá khứ. Biểu đạt tâm trạng 'Lẽ ra tôi nên làm thế, nhưng đã không làm...'.",
            q3_ex1: "Ví dụ 1: Lẽ ra lúc đó tôi nên học chăm hơn (bây giờ điểm không tốt nên tôi hối hận).",
            q3_ex2: "Ví dụ 2: Lẽ ra tôi nên nói thật trong buổi phỏng vấn (tôi hối hận vì đã nói dối).",
            step2_title: "Bước 2: Lập kế hoạch cho hiện tại và tương lai",
            step2_desc: "Bây giờ, hãy xem xét bản thân ở hiện tại và lập kế hoạch cho tương lai.",
            q4_title: "Câu hỏi 4: Bây giờ bạn đã đến gần mục tiêu bao nhiêu rồi? Kế hoạch cụ thể sắp tới là gì?",
            q4_grammar1: "Ngữ pháp đề xuất: V-(으)려면 멀었다",
            q4_desc1: "Sử dụng khi vẫn cần nhiều thời gian và nỗ lực để đạt được mục tiêu mong muốn. Có nghĩa là 'Còn lâu mới...'.",
            q4_ex1: "Ví dụ 1: Để đi du học thì phải nhận được học bổng nhưng vẫn còn xa lắm.",
            q4_grammar2: "Ngữ pháp đề xuất: V-(으)ㄹ 생각[계획, 예정]이다",
            q4_desc2: "Sử dụng để nói về ý định hoặc kế hoạch của bạn trong tương lai. Có thể sử dụng '생각이다' (dự định), '계획이다' (kế hoạch), hoặc '예정이다' (dự kiến).",
            q4_ex2: "Ví dụ 2: Tôi có kế hoạch viết sơ yếu lý lịch để xin việc vào một công ty lớn vào năm sau.",
            q5_title: "Câu hỏi 5: Mọi người xung quanh nghĩ gì về bạn khi bạn đang nỗ lực vì mục tiêu? (Hãy thử đoán)",
            q5_grammar: "Ngữ pháp đề xuất: A-(으)ㄴ 모양이다, V-는 모양이다, N인 모양이다",
            q5_desc: "Sử dụng khi bạn đoán 'có vẻ như...' dựa trên hành động hoặc tình huống của người khác. Tương tự như 'It seems like...' hoặc 'It looks like...'.",
            q5_ex1: "Ví dụ 1: Thấy tôi học khuya mỗi ngày, chắc bố mẹ tôi nghĩ rằng tôi đang vất vả lắm.",
            q5_ex2: "Ví dụ 2: Thấy các thành viên trong nhóm thường xuyên giúp đỡ tôi, có vẻ như tôi còn lúng túng trong công việc.",
            step3_title: "Bước 3: Chuẩn bị cho mục tiêu",
            step3_desc: "Cuối cùng, hãy nói về những điều cần thiết và những lo lắng của bạn trong việc đạt được mục tiêu.",
            q6_title: "Câu hỏi 6: Điều kiện tiên quyết để đạt được mục tiêu là gì?",
            q6_grammar1: "Ngữ pháp đề xuất: A/V-아야/어야/여야",
            q6_desc1: "Sử dụng để nêu một điều kiện cần thiết cho kết quả theo sau. Có nghĩa là 'Bạn phải làm A để làm B'.",
            q6_ex1: "Ví dụ 1: Để thành công ở Hàn Quốc, bạn phải có hiểu biết sâu sắc về văn hóa Hàn Quốc.",
            q6_grammar2: "Ngữ pháp đề xuất: V-도록",
            q6_desc2: "Sử dụng để giải thích mục đích hoặc lý do cho hành động theo sau. Dễ hiểu hơn khi nghĩ là 'Tôi đã làm điều này để...'.",
            q6_ex2: "Ví dụ 2: Tôi đã thức suốt đêm chuẩn bị tài liệu để thuyết trình tốt vào tuần sau.",
            q7_title: "Câu hỏi 7: Bạn lo lắng nhất điều gì trong quá trình đạt được mục tiêu và bạn đang chuẩn bị cho nó như thế nào?",
            q7_grammar1: "Ngữ pháp đề xuất: A/V-(으)ㄹ까 봐",
            q7_desc1: "Sử dụng khi bạn lo lắng rằng một điều gì đó tồi tệ có thể xảy ra. Thường đi kèm với một hành động bạn đã làm vì lo lắng đó.",
            q7_ex1: "Ví dụ 1: Tôi lo rằng mình sẽ mắc lỗi trong buổi phỏng vấn nên đã luyện tập nhiều lần.",
            q7_grammar2: "Ngữ pháp đề xuất: 무엇이든지 / 무슨 N(이)든지",
            q7_desc2: "Có nghĩa là 'bất cứ' hoặc 'dù là gì', không phân biệt lựa chọn. Có thể được sử dụng để cho thấy rằng bất cứ điều gì cũng được hoặc để bày tỏ ý chí làm mọi thứ.",
            q7_ex2: "Ví dụ 2: Tôi đã nhờ tiền bối giúp đỡ bất cứ điều gì vì thành công của mình.",
            practice_placeholder: "Hãy viết câu thực hành của bạn vào đây...",
            saved_message: "Nội dung đã được lưu!"
        },
        ja: {
            meta_title: "韓国語スピーキング練習アプリ",
            app_title: "留学生のための韓国語スピーキング試験完全対策",
            app_subtitle: "私の経験を通じて未来の計画を立てる",
            step1_title: "ステップ1：私の過去を振り返る",
            step1_desc: "まず、あなたの目標に関連する過去の経験を思い出してみてください。",
            q1_title: "質問1：目標のために過去に続けていたことや習慣はありますか？",
            q1_grammar: "推奨文法：V-던",
            q1_desc: "過去によく、そして続けていたことを話すときに使います。「I used to...」と似た感じです。今はしていないことを思い出して話すときに自然です。",
            q1_ex1: "例文1：私が留学を準備していた頃は、毎日朝5時に起きて韓国語のニュースを聞いていました。",
            q1_ex2: "例文2：大学時代に一緒に勉強していた友達は、今韓国の大企業に通っています。",
            q2_title: "質問2：その努力のおかげで、今何が変わりましたか？",
            q2_grammar1: "推奨文法：V-았더니/었더니",
            q2_desc1: "「ある行動をしました。そしたらこんな結果が出ました。」と言うときに使います。前の行動によって生じた新しい事実や結果を伝えるのに適しています。",
            q2_ex1: "例文1：着実に運動をしたら、体が丈夫になりました。",
            q2_grammar2: "推奨文法：얼마나 A-(으)ㄴ/V-는지 모르다",
            q2_desc2: "「本当に」「とても」を強調したいときに使います。「You have no idea how...」という感じで、強い感情を表現できます。",
            q2_ex2: "例文2：前の学期にあまり寝なかったので、試験が終わってからどれだけ疲れたかわかりません。",
            q3_title: "質問3：あの時、違う行動をしていたらもっと良かったでしょうか？後悔していることはありますか？",
            q3_grammar: "推奨文法：A/V-았어야/었어야 했는데",
            q3_desc: "過去にしなかったことについて後悔したり、残念に思うときに使います。「I should have done that, but I didn't...」という気持ちを表します。",
            q3_ex1: "例文1：あの時もっと一生懸命勉強すればよかった（今、成績が良くなくて後悔しています）。",
            q3_ex2: "例文2：面接の時、その質問に正直に言えばよかった（嘘をついて後悔しています）。",
            step2_title: "ステップ2：現在と未来を計画する",
            step2_desc: "さて、現在の自分を見つめ、未来を計画してみましょう。",
            q4_title: "質問4：今、目標にどれくらい近づきましたか？今後の具体的な計画は何ですか？",
            q4_grammar1: "推奨文法：V-(으)려면 멀었다",
            q4_desc1: "自分の望む目標や結果までまだ多くの時間と努力が必要なときに使います。「It's a long way to go before...」という意味です。",
            q4_ex1: "例文1：留学に行くには奨学金をもらわなければならないが、まだ遠いです。",
            q4_grammar2: "推奨文法：V-(으)ㄹ 생각[계획, 예정]이다",
            q4_desc2: "未来に何をするか、自分の意志や計画を話すときに使います。「생각이다」（〜するつもりだ）、「계획이다」（〜する計画だ）、「예정이다」（〜する予定だ）が使えます。",
            q4_ex2: "例文2：来年、大企業に就職するために履歴書を作成する計画です。",
            q5_title: "質問5：周りの人々は、目標に向かって努力しているあなたをどう見ているでしょうか？（推測してみてください）",
            q5_grammar: "推奨文法：A-(으)ㄴ 모양이다, V-는 모양이다, N인 모양이다",
            q5_desc: "他人の行動や状況を見て「〜のようだ」と推測するときに使います。「It seems like...」や「It looks like...」と似ています。",
            q5_ex1: "例文1：私が毎晩遅くまで勉強しているのを見て、両親は私が大変そうだと思っているでしょう。",
            q5_ex2: "例文2：チームのメンバーがよく手伝ってくれるのを見ると、私は仕事が下手なようです。",
            step3_title: "ステップ3：目標のために準備する",
            step3_desc: "最後に、目標を達成するために必要なことや心配な点について話してみましょう。",
            q6_title: "質問6：目標を達成するために必ずしなければならないことは何ですか？",
            q6_grammar1: "推奨文法：A/V-아야/어야/여야",
            q6_desc1: "後の結果のために必ず必要な条件を言うときに使います。「BをするためにはAをしなければならない」という意味です。",
            q6_ex1: "例文1：韓国で成功するには、韓国文化に対する深い理解がなければなりません。",
            q6_grammar2: "推奨文法：V-도록",
            q6_desc2: "後の行動の目的や理由を説明するときに使います。「I did this so that...」と考えると簡単です。",
            q6_ex2: "例文2：来週のプレゼンテーションがうまくいくように、徹夜で資料を準備しました。",
            q7_title: "質問7：目標を達成する過程で最も心配なことは何ですか？そして、どのように備えていますか？",
            q7_grammar1: "推奨文法：A/V-(으)ㄹ까 봐",
            q7_desc1: "悪いことが起こるかもしれないと心配するときに使います。そのため、通常、その心配のために 어떤行動をしたかを一緒に話します。",
            q7_ex1: "例文1：面接で失敗するかと心配で、面接の練習を何度もしました。",
            q7_grammar2: "推奨文法：무엇이든지 / 무슨 N(이)든지",
            q7_desc2: "選択に関係なく、「any」または「no matter what」という意味です。何でもいい、またはすべてをやるという意志を示すときに使えます。",
            q7_ex2: "例文2：成功のためなら何でも手伝ってほしいと先輩にお願いしました。",
            practice_placeholder: "ここに練習文を作成してみてください...",
            saved_message: "内容が保存されました！"
        },
        zh: {
            meta_title: "韩语口语练习应用",
            app_title: "为留学生打造的完美韩语口语考试备考指南",
            app_subtitle: "通过我的经验规划未来",
            step1_title: "第一步：回顾我的过去",
            step1_desc: "首先，请回想一下与您目标相关的过去经历。",
            q1_title: "问题1：为了目标，您过去坚持做过什么或有什么习惯？",
            q1_grammar: "推荐语法：V-던",
            q1_desc: "用于谈论过去经常且持续做的事情。感觉类似于“I used to...”。在回忆现在不做的事情时使用很自然。",
            q1_ex1: "例句1：我准备留学的时候，记得每天凌晨5点起床听韩语新闻。",
            q1_ex2: "例句2：大学时一起学习的朋友现在在一家韩国大公司工作。",
            q2_title: "问题2：得益于那些努力，现在有什么变化？",
            q2_grammar1: "推荐语法：V-았더니/었더니",
            q2_desc1: "当您说“我做了某件事，结果发生了……”时使用。适合用来解释由过去行为引起的新事实或结果。",
            q2_ex1: "例句1：我坚持锻炼，结果身体变好了。",
            q2_grammar2: "推荐语法：얼마나 A-(으)ㄴ/V-는지 모르다",
            q2_desc2: "用于强调“真的”或“非常”。有“你不知道有多……”的感觉，可以表达强烈的情感。",
            q2_ex2: "例句2：上学期我没怎么睡觉，所以你不知道考试后我有多累。",
            q3_title: "问题3：如果当时采取了不同的行动，会更好吗？有什么后悔的事吗？",
            q3_grammar: "推荐语法：A/V-았어야/었어야 했는데",
            q3_desc: "用于对过去未做之事表示后悔或惋惜。表达“我本应该那么做，但我没有……”的情感。",
            q3_ex1: "例句1：当时我应该更努力学习的（我现在成绩不好，所以很后悔）。",
            q3_ex2: "例句2：面试时我应该对那个问题说实话的（我后悔撒了谎）。",
            step2_title: "第二步：规划现在和未来",
            step2_desc: "现在，让我们审视当下，并为未来做计划。",
            q4_title: "问题4：您现在离目标有多近？未来的具体计划是什么？",
            q4_grammar1: "推荐语法：V-(으)려면 멀었다",
            q4_desc1: "当您距离期望的目标还需要很多时间和努力时使用。意思是“离……还有很长的路要走”。",
            q4_ex1: "例句1：要拿到奖学金去留学，还有很长的路要走。",
            q4_grammar2: "推荐语法：V-(으)ㄹ 생각[계획, 예정]이다",
            q4_desc2: "用于陈述您未来的意图或计划。您可以使用“생각이다”（打算）、“계획이다”（计划）或“예정이다”（预定）。",
            q4_ex2: "例句2：我计划明年写简历，以便在一家大公司找到工作。",
            q5_title: "问题5：当您为目标奋斗时，周围的人怎么看您？（猜一猜）",
            q5_grammar: "推荐语法：A-(으)ㄴ 모양이다, V-는 모양이다, N인 모양이다",
            q5_desc: "当您根据某人的行为或情况猜测“好像……”时使用。类似于“It seems like...”或“It looks like...”。",
            q5_ex1: "例句1：看到我每晚学习到很晚，我父母可能觉得我很辛苦。",
            q5_ex2: "例句2：看到我的团队成员经常帮助我，看来我的工作还不太熟练。",
            step3_title: "第三步：为目标做准备",
            step3_desc: "最后，让我们谈谈实现目标所必需的条件和您所担心的问题。",
            q6_title: "问题6：实现目标必须具备哪些条件？",
            q6_grammar1: "推荐语法：A/V-아야/어야/여야",
            q6_desc1: "用于说明后续结果的必要条件。意思是“你必须做A才能做B”。",
            q6_ex1: "例句1：要在韩国成功，你必须对韩国文化有深入的了解。",
            q6_grammar2: "推荐语法：V-도록",
            q6_desc2: "用于解释后续行动的目的或原因。可以简单地理解为“我这么做是为了……”。",
            q6_ex2: "例句2：为了下周的演示能做好，我熬夜准备了材料。",
            q7_title: "问题7：在实现目标的过程中，您最担心什么？您是如何准备的？",
            q7_grammar1: "推荐语法：A/V-(으)ㄹ까 봐",
            q7_desc1: "当您担心可能会发生不好的事情时使用。后面通常会跟上您因此而采取的行动。",
            q7_ex1: "例句1：我担心面试时会出错，所以练习了好几次。",
            q7_grammar2: "推荐语法：무엇이든지 / 무슨 N(이)든지",
            q7_desc2: "意思是“任何”或“无论什么”，与选择无关。可以用来表示任何事情都可以，或表达愿意做任何事情的决心。",
            q7_ex2: "例句2：为了成功，我请前辈帮我做任何事情。",
            practice_placeholder: "请在这里写下您的练习句...",
            saved_message: "内容已保存！"
        }
    };

    // This object defines the structure of the page.
    const pageStructure = [
        {
            type: 'step',
            titleKey: 'step1_title',
            descKey: 'step1_desc',
            questions: [
                {
                    id: 'q1',
                    titleKey: 'q1_title',
                    grammars: [
                        { grammarKey: 'q1_grammar', descKey: 'q1_desc', exKeys: ['q1_ex1', 'q1_ex2'] }
                    ]
                },
                {
                    id: 'q2',
                    titleKey: 'q2_title',
                    grammars: [
                        { grammarKey: 'q2_grammar1', descKey: 'q2_desc1', exKeys: ['q2_ex1'] },
                        { grammarKey: 'q2_grammar2', descKey: 'q2_desc2', exKeys: ['q2_ex2'] }
                    ]
                },
                {
                    id: 'q3',
                    titleKey: 'q3_title',
                    grammars: [
                        { grammarKey: 'q3_grammar', descKey: 'q3_desc', exKeys: ['q3_ex1', 'q3_ex2'] }
                    ]
                }
            ]
        },
        {
            type: 'step',
            titleKey: 'step2_title',
            descKey: 'step2_desc',
            questions: [
                {
                    id: 'q4',
                    titleKey: 'q4_title',
                    grammars: [
                        { grammarKey: 'q4_grammar1', descKey: 'q4_desc1', exKeys: ['q4_ex1'] },
                        { grammarKey: 'q4_grammar2', descKey: 'q4_desc2', exKeys: ['q4_ex2'] }
                    ]
                },
                {
                    id: 'q5',
                    titleKey: 'q5_title',
                    grammars: [
                        { grammarKey: 'q5_grammar', descKey: 'q5_desc', exKeys: ['q5_ex1', 'q5_ex2'] }
                    ]
                }
            ]
        },
        {
            type: 'step',
            titleKey: 'step3_title',
            descKey: 'step3_desc',
            questions: [
                 {
                    id: 'q6',
                    titleKey: 'q6_title',
                    grammars: [
                        { grammarKey: 'q6_grammar1', descKey: 'q6_desc1', exKeys: ['q6_ex1'] },
                        { grammarKey: 'q6_grammar2', descKey: 'q6_desc2', exKeys: ['q6_ex2'] }
                    ]
                },
                {
                    id: 'q7',
                    titleKey: 'q7_title',
                    grammars: [
                        { grammarKey: 'q7_grammar1', descKey: 'q7_desc1', exKeys: ['q7_ex1'] },
                        { grammarKey: 'q7_grammar2', descKey: 'q7_desc2', exKeys: ['q7_ex2'] }
                    ]
                }
            ]
        }
    ];

    document.addEventListener('DOMContentLoaded', () => {
        const mainContent = document.getElementById('main-content');
        const languageSelector = document.getElementById('language-selector');
        const saveButton = document.getElementById('save-button');
        const captureButton = document.getElementById('capture-button');
        const saveNotification = document.getElementById('save-notification');

        // Function to build the HTML structure from the pageStructure object
        function buildPage() {
            mainContent.innerHTML = ''; // Clear existing content
            pageStructure.forEach(step => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'mb-12 fade-in';
                
                let stepHTML = `
                    <div class="mb-6 pb-2 border-b-2 border-blue-500">
                        <h2 class="text-2xl font-bold text-gray-700" data-lang-key="${step.titleKey}"></h2>
                        <p class="text-gray-500 mt-1" data-lang-key="${step.descKey}"></p>
                    </div>
                `;
                
                step.questions.forEach(q => {
                    let grammarsHTML = '';
                    q.grammars.forEach(g => {
                        let examplesHTML = g.exKeys.map(exKey => `<li class="mt-1" data-lang-key="${exKey}"></li>`).join('');
                        grammarsHTML += `
                            <div class="mt-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-r-lg">
                                <h4 class="font-semibold text-blue-800" data-lang-key="${g.grammarKey}"></h4>
                                <p class="mt-1 text-gray-600" data-lang-key="${g.descKey}"></p>
                                <ul class="list-disc list-inside mt-2 text-sm text-gray-500 pl-2">${examplesHTML}</ul>
                            </div>
                        `;
                    });

                    stepHTML += `
                        <div class="grammar-card bg-white p-6 rounded-xl shadow-md mb-6">
                            <h3 class="font-bold text-lg" data-lang-key="${q.titleKey}"></h3>
                            ${grammarsHTML}
                            <div class="mt-4">
                                <textarea id="practice-${q.id}" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent transition" rows="4" data-lang-placeholder="practice_placeholder"></textarea>
                            </div>
                        </div>
                    `;
                });
                stepDiv.innerHTML = stepHTML;
                mainContent.appendChild(stepDiv);
            });
        }
        
        // Function to change language
        function changeLanguage(lang) {
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.getAttribute('data-lang-key');
                // Check if the key is for an example sentence (e.g., q1_ex1, q2_ex2)
                const isExampleSentence = /^q\d+_ex\d+$/.test(key);

                if (isExampleSentence) {
                    // Always display example sentences in Korean for learning purposes
                    if (translations['ko'] && translations['ko'][key]) {
                        el.innerHTML = translations['ko'][key];
                    }
                } else {
                    // Translate all other elements to the selected language
                    if (translations[lang] && translations[lang][key]) {
                        el.innerHTML = translations[lang][key];
                    }
                }
            });
             document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
                const key = el.getAttribute('data-lang-placeholder');
                if (translations[lang] && translations[lang][key]) {
                    el.placeholder = translations[lang][key];
                }
            });
            document.documentElement.lang = lang;
            localStorage.setItem('selectedLanguage', lang);
        }

        // Function to save data
        function saveData() {
            const data = {};
            document.querySelectorAll('textarea[id^="practice-"]').forEach(textarea => {
                data[textarea.id] = textarea.value;
            });
            localStorage.setItem('koreanSpeakingPracticeData', JSON.stringify(data));
            
            saveNotification.classList.remove('hidden');
            setTimeout(() => {
                saveNotification.classList.add('hidden');
            }, 2000);
        }

        // Function to load data
        function loadData() {
            const data = JSON.parse(localStorage.getItem('koreanSpeakingPracticeData'));
            if (data) {
                Object.keys(data).forEach(key => {
                    const textarea = document.getElementById(key);
                    if (textarea) {
                        textarea.value = data[key];
                    }
                });
            }
        }

        // --- EDITED SECTION: Improved screen capture function ---
        function captureScreen() {
            const fabContainer = document.getElementById('fab-container');
            const captureElement = document.getElementById('app-container');

            // Hide floating buttons to prevent them from appearing in the screenshot
            if (fabContainer) fabContainer.style.visibility = 'hidden';

            // Scroll to the top of the page to ensure the capture starts from the beginning
            window.scrollTo(0, 0);

            // Use devicePixelRatio for better quality on high-DPI (mobile) screens
            const scale = window.devicePixelRatio || 2;

            html2canvas(captureElement, {
                useCORS: true, // Handle cross-origin resources like fonts
                allowTaint: true,
                scale: scale, // Dynamically set scale for better quality
                backgroundColor: '#f9fafb',
                // Explicitly set the width and height to capture the entire element
                width: captureElement.scrollWidth,
                height: captureElement.scrollHeight,
                windowWidth: captureElement.scrollWidth,
                windowHeight: captureElement.scrollHeight,
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'korean-speaking-practice.png';
                link.href = canvas.toDataURL('image/png');
                link.click();

                // Show the floating buttons again after the capture is done
                if (fabContainer) fabContainer.style.visibility = 'visible';
            }).catch(err => {
                console.error("Screenshot failed:", err);
                // Also show the buttons in case of an error
                if (fabContainer) fabContainer.style.visibility = 'visible';
            });
        }
        
        // Initial setup
        buildPage(); // Build the page first
        
        const savedLang = localStorage.getItem('selectedLanguage') || 'ko';
        languageSelector.value = savedLang;
        changeLanguage(savedLang);
        loadData();

        // Event Listeners
        languageSelector.addEventListener('change', (e) => changeLanguage(e.target.value));
        saveButton.addEventListener('click', saveData);
        captureButton.addEventListener('click', captureScreen);
    });
</script>
</body>
</html>

