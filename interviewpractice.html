<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="meta_title">한국어 말하기 연습 앱</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .grammar-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .grammar-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Styles for the results modal */
        #result-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 1rem;
        }
        #result-modal {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            width: 100%;
            max-width: 800px;
            height: 90vh;
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app-container" class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Header -->
        <header class="mb-8 p-6 bg-white rounded-xl shadow-md">
            <div class="flex flex-col sm:flex-row justify-between items-center">
                <div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-blue-600" data-lang-key="app_title">유학생을 위한 한국어 말하기 시험 완벽 대비</h1>
                    <p class="mt-1 text-gray-500" data-lang-key="app_subtitle">나의 경험을 통해 미래 계획 세우기</p>
                </div>
                <div class="mt-4 sm:mt-0">
                    <select id="language-selector" class="block w-full sm:w-auto p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="ko">한국어</option>
                        <option value="en">English</option>
                        <option value="vi">Tiếng Việt</option>
                        <option value="ja">日本語</option>
                        <option value="zh">中文</option>
                    </select>
                </div>
            </div>
        </header>

        <main id="main-content">
            <!-- Sections will be dynamically generated here -->
        </main>
    </div>

    <!-- Floating Action Buttons -->
    <div id="fab-container" class="fixed bottom-6 right-6 flex flex-col space-y-3">
        <button id="save-button" class="bg-blue-600 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center hover:bg-blue-700 transition-transform transform hover:scale-110" title="Save progress">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V7l-4-4z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M7 3v6h10V3" />
            </svg>
        </button>
        <button id="show-result-button" class="bg-green-600 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center hover:bg-green-700 transition-transform transform hover:scale-110" title="결과 보기 및 다운로드">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
        </button>
    </div>

    <!-- Custom Alert Modal -->
    <div id="save-notification" class="hidden fixed top-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-xl transition-opacity duration-300">
        <p data-lang-key="saved_message">내용이 저장되었습니다!</p>
    </div>

<script>
    const translations = {
        ko: {
            meta_title: "한국어 말하기 연습 앱",
            app_title: "유학생을 위한 한국어 말하기 시험 완벽 대비",
            app_subtitle: "나의 경험을 통해 미래 계획 세우기",
            step1_title: "1단계: 나의 과거 돌아보기",
            step1_desc: "먼저, 여러분의 목표와 관련된 과거의 경험을 떠올려 보세요.",
            q1_title: "질문 1: 목표를 위해 과거에 꾸준히 했던 일이나 습관이 있나요?",
            q1_grammar: "추천 문법: V-던",
            q1_desc: "과거에 자주, 그리고 계속했던 일을 말할 때 사용해요. 'I used to...'와 비슷한 느낌이에요. 지금은 하지 않는 일을 추억하며 말할 때 자연스러워요.",
            q1_ex1: "예문 1: 제가 유학을 준비하던 시절에는 매일 새벽 5시에 일어나서 한국어 뉴스를 듣곤 했어요.",
            q1_ex2: "예문 2: 대학교 때 같이 공부하던 친구는 지금 한국 대기업에 다니고 있어요.",
            q2_title: "질문 2: 그 노력 덕분에 지금 무엇이 달라졌나요?",
            q2_grammar1: "추천 문법: V-았더니/었더니",
            q2_desc1: "'어떤 행동을 했어요. 그랬더니 이런 결과가 나타났어요.' 라고 말할 때 사용해요. 앞에 한 행동 때문에 생긴 새로운 사실이나 결과를 알려줄 때 좋아요.",
            q2_ex1: "예문 1: 꾸준히 운동을 했더니 몸이 좋아졌어요.",
            q2_grammar2: "추천 문법: 얼마나 A-(으)ㄴ/V-는지 모르다",
            q2_desc2: "'정말', '아주 많이'를 강조하고 싶을 때 사용해요. 'You have no idea how...'라는 느낌으로, 강한 감정을 표현할 수 있어요.",
            q2_ex2: "예문 2: 지난 학기에 너무 잠을 안 잤더니 시험 끝나고 얼마나 피곤했는지 몰라요.",
            q3_title: "질문 3: 그때 다르게 행동했다면 더 좋았을까요? 후회되는 일이 있나요?",
            q3_grammar: "추천 문법: A/V-았어야/었어야 했는데",
            q3_desc: "과거에 하지 않은 일에 대해 후회하거나 아쉬워할 때 사용해요. 'I should have done that, but I didn't...' 이런 마음을 표현해요.",
            q3_ex1: "예문 1: 그때 좀 더 열심히 공부했어야 했는데 (지금 성적이 안 좋아서 후회돼요).",
            q3_ex2: "예문 2: 면접 때 그 질문에 사실대로 말했어야 했는데 (괜히 거짓말을 해서 후회됩니다).",
            step2_title: "2단계: 현재와 미래 계획하기",
            step2_desc: "이제 현재의 나를 살펴보고, 미래를 계획해 봅시다.",
            q4_title: "질문 4: 지금 목표에 얼마나 가까워졌나요? 앞으로의 구체적인 계획은 무엇인가요?",
            q4_grammar1: "추천 문법: V-(으)려면 멀었다",
            q4_desc1: "내가 원하는 목표나 결과까지 아직 시간이 많이 필요하고, 더 노력해야 할 때 사용해요. 'It's a long way to go before...' 라는 의미예요.",
            q4_ex1: "예문 1: 유학을 가려면 장학금을 받아야 하는데 아직 멀었어요.",
            q4_grammar2: "추천 문법: V-(으)ㄹ 생각[계획, 예정]이다",
            q4_desc2: "미래에 무엇을 할 것인지 나의 의지나 계획을 말할 때 사용해요. '생각이다', '계획이다', '예정이다' 모두 사용할 수 있어요.",
            q4_ex2: "예문 2: 내년에 대기업에 취직하기 위해 이력서를 작성할 계획입니다.",
            q5_title: "질문 5: 주변 사람들은 노력하는 나를 어떻게 볼까요? (추측해 보세요)",
            q5_grammar: "추천 문법: A-(으)ㄴ 모양이다, V-는 모양이다, N인 모양이다",
            q5_desc: "다른 사람의 행동이나 상황을 보고 '그런 것 같아요'라고 추측할 때 사용해요. 'It seems like...' 또는 'It looks like...' 와 비슷해요.",
            q5_ex1: "예문 1: 제가 매일 밤늦게까지 공부하는 것을 보니 부모님은 제가 힘든 모양이다라고 생각하실 거예요.",
            q5_ex2: "예문 2: 팀원들이 저를 자주 도와주는 것을 보니 제가 일이 서툰 모양입니다.",
            step3_title: "3단계: 목표를 위해 준비하기",
            step3_desc: "마지막으로, 목표를 이루기 위해 필요한 것과 걱정되는 점을 이야기해 봅시다.",
            q6_title: "질문 6: 목표를 이루기 위해 꼭 해야 하는 것은 무엇인가요?",
            q6_grammar1: "추천 문법: A/V-아야/어야/여야",
            q6_desc1: "뒤에 오는 결과를 위해 반드시 필요한 조건을 말할 때 사용해요. 'You must do A to do B' 라는 의미예요.",
            q6_ex1: "예문 1: 한국에서 성공하려면 한국 문화에 대한 깊은 이해가 있어야 합니다.",
            q6_grammar2: "추천 문법: V-도록",
            q6_desc2: "뒤에 오는 행동의 목적이나 이유를 설명할 때 사용해요. 'I did this so that...' 이라고 생각하면 쉬워요.",
            q6_ex2: "예문 2: 다음 주 프레젠테이션을 잘하도록 밤새서 자료를 준비했어요.",
            q7_title: "질문 7: 목표를 이루는 과정에서 무엇이 가장 걱정되고, 어떻게 대비하고 있나요?",
            q7_grammar1: "추천 문법: A/V-(으)ㄹ까 봐",
            q7_desc1: "안 좋은 일이 생길 것 같아서 미리 걱정될 때 사용해요. 그래서 보통 뒤에는 그 걱정 때문에 어떤 행동을 했는지 함께 말해요.",
            q7_ex1: "예문 1: 면접에서 실수를 할까 봐 걱정돼서 면접 연습을 여러 번 했어요.",
            q7_grammar2: "추천 문법: 무엇이든지 / 무슨 N(이)든지",
            q7_desc2: "선택에 상관없이 'any' 또는 'no matter what' 이라는 의미예요. 어떤 것이든 괜찮거나, 모든 것을 다 하겠다는 의지를 보여줄 때 사용할 수 있어요.",
            q7_ex2: "예문 2: 성공을 위해 무엇이든지 도와 달라고 선배에게 부탁했습니다.",
            practice_placeholder: "여기에 연습 문장을 작성해 보세요...",
            saved_message: "내용이 저장되었습니다!",
            result_title: "연습 결과 보기",
            no_answer: "작성된 답변이 없습니다.",
            answer_label: "답변",
            download_button: "텍스트로 다운로드",
            close_button: "닫기"
        },
        en: {
            meta_title: "Korean Speaking Practice App",
            app_title: "Perfect Korean Speaking Test Prep for International Students",
            app_subtitle: "Planning the Future Through My Experiences",
            step1_title: "Step 1: Looking Back at My Past",
            step1_desc: "First, let's recall past experiences related to your goals.",
            q1_title: "Question 1: What did you consistently do or what habits did you have in the past for your goal?",
            q1_grammar: "Recommended Grammar: V-던",
            q1_desc: "Used when talking about things you often and continuously did in the past. It has a similar feel to 'I used to...'. It's natural when reminiscing about things you don't do anymore.",
            q1_ex1: "Example 1: When I was preparing to study abroad, I remember waking up at 5 AM every day to listen to Korean news.",
            q1_ex2: "Example 2: A friend I used to study with in university now works at a large Korean corporation.",
            q2_title: "Question 2: Thanks to those efforts, what has changed now?",
            q2_grammar1: "Recommended Grammar: V-았더니/었더니",
            q2_desc1: "Used when you say, 'I did something, and as a result, this happened.' It's good for explaining a new fact or result caused by a past action.",
            q2_ex1: "Example 1: I exercised consistently, and as a result, my body got healthier.",
            q2_grammar2: "Recommended Grammar: 얼마나 A-(으)ㄴ/V-는지 모르다",
            q2_desc2: "Use this to emphasize 'really' or 'very much'. It has a feeling of 'You have no idea how...' and can express strong emotions.",
            q2_ex2: "Example 2: I didn't sleep much last semester, so you have no idea how tired I was after the exams.",
            q3_title: "Question 3: Would it have been better if you had acted differently then? Is there anything you regret?",
            q3_grammar: "Recommended Grammar: A/V-았어야/었어야 했는데",
            q3_desc: "Used to express regret or sorrow about something you didn't do in the past. It expresses the sentiment of 'I should have done that, but I didn't...'.",
            q3_ex1: "Example 1: I should have studied harder back then (I regret it because my grades aren't good now).",
            q3_ex2: "Example 2: I should have told the truth to that question during the interview (I regret lying).",
            step2_title: "Step 2: Planning the Present and Future",
            step2_desc: "Now, let's examine the present and plan for the future.",
            q4_title: "Question 4: How close are you to your goal now? What are your specific plans for the future?",
            q4_grammar1: "Recommended Grammar: V-(으)려면 멀었다",
            q4_desc1: "Used when you still need a lot of time and effort to reach your desired goal. It means 'It's a long way to go before...'.",
            q4_ex1: "Example 1: I need to get a scholarship to study abroad, but I still have a long way to go.",
            q4_grammar2: "Recommended Grammar: V-(으)ㄹ 생각[계획, 예정]이다",
            q4_desc2: "Used to state your intention or plan for the future. You can use '생각이다' (think of), '계획이다' (plan to), or '예정이다' (am scheduled to).",
            q4_ex2: "Example 2: I plan to write my resume to get a job at a large company next year.",
            q5_title: "Question 5: What do people around you think of you as you strive for your goal? (Make a guess)",
            q5_grammar: "Recommended Grammar: A-(으)ㄴ 모양이다, V-는 모양이다, N인 모양이다",
            q5_desc: "Used when you guess 'it seems like...' based on someone's actions or a situation. Similar to 'It seems like...' or 'It looks like...'.",
            q5_ex1: "Example 1: Seeing me study late every night, my parents probably think it must be hard for me.",
            q5_ex2: "Example 2: Seeing my team members help me often, it seems I'm not very skilled at my work.",
            step3_title: "Step 3: Preparing for the Goal",
            step3_desc: "Finally, let's talk about what's necessary and what worries you have in achieving your goal.",
            q6_title: "Question 6: What are the essential conditions to achieve your goal?",
            q6_grammar1: "Recommended Grammar: A/V-아야/어야/여야",
            q6_desc1: "Used to state a necessary condition for the following result. It means 'You must do A to do B'.",
            q6_ex1: "Example 1: To succeed in Korea, you must have a deep understanding of Korean culture.",
            q6_grammar2: "Recommended Grammar: V-도록",
            q6_desc2: "Used to explain the purpose or reason for the following action. It's easy to think of it as 'I did this so that...'.",
            q6_ex2: "Example 2: I stayed up all night preparing materials to do well in next week's presentation.",
            q7_title: "Question 7: What are you most worried about in the process of achieving your goal, and how are you preparing for it?",
            q7_grammar1: "Recommended Grammar: A/V-(으)ㄹ까 봐",
            q7_desc1: "Used when you're worried that something bad might happen. It's often followed by an action you took because of that worry.",
            q7_ex1: "Example 1: I was worried I might make a mistake in the interview, so I practiced for it several times.",
            q7_grammar2: "Recommended Grammar: 무엇이든지 / 무슨 N(이)든지",
            q7_desc2: "Means 'any' or 'no matter what', regardless of the choice. It can be used to show that anything is fine or to express a will to do everything.",
            q7_ex2: "Example 2: I asked my senior to help me with anything for my success.",
            practice_placeholder: "Write your practice sentences here...",
            saved_message: "Content saved successfully!",
            result_title: "View Practice Results",
            no_answer: "No answer written.",
            answer_label: "Answer",
            download_button: "Download as Text",
            close_button: "Close"
        },
        // vi, ja, zh translations are omitted for brevity but would follow the same pattern
    };

    // This object defines the structure of the page.
    const pageStructure = [
        {
            type: 'step',
            titleKey: 'step1_title',
            descKey: 'step1_desc',
            questions: [
                {
                    id: 'q1',
                    titleKey: 'q1_title',
                    grammars: [
                        { grammarKey: 'q1_grammar', descKey: 'q1_desc', exKeys: ['q1_ex1', 'q1_ex2'] }
                    ]
                },
                {
                    id: 'q2',
                    titleKey: 'q2_title',
                    grammars: [
                        { grammarKey: 'q2_grammar1', descKey: 'q2_desc1', exKeys: ['q2_ex1'] },
                        { grammarKey: 'q2_grammar2', descKey: 'q2_desc2', exKeys: ['q2_ex2'] }
                    ]
                },
                {
                    id: 'q3',
                    titleKey: 'q3_title',
                    grammars: [
                        { grammarKey: 'q3_grammar', descKey: 'q3_desc', exKeys: ['q3_ex1', 'q3_ex2'] }
                    ]
                }
            ]
        },
        {
            type: 'step',
            titleKey: 'step2_title',
            descKey: 'step2_desc',
            questions: [
                {
                    id: 'q4',
                    titleKey: 'q4_title',
                    grammars: [
                        { grammarKey: 'q4_grammar1', descKey: 'q4_desc1', exKeys: ['q4_ex1'] },
                        { grammarKey: 'q4_grammar2', descKey: 'q4_desc2', exKeys: ['q4_ex2'] }
                    ]
                },
                {
                    id: 'q5',
                    titleKey: 'q5_title',
                    grammars: [
                        { grammarKey: 'q5_grammar', descKey: 'q5_desc', exKeys: ['q5_ex1', 'q5_ex2'] }
                    ]
                }
            ]
        },
        {
            type: 'step',
            titleKey: 'step3_title',
            descKey: 'step3_desc',
            questions: [
                 {
                    id: 'q6',
                    titleKey: 'q6_title',
                    grammars: [
                        { grammarKey: 'q6_grammar1', descKey: 'q6_desc1', exKeys: ['q6_ex1'] },
                        { grammarKey: 'q6_grammar2', descKey: 'q6_desc2', exKeys: ['q6_ex2'] }
                    ]
                },
                {
                    id: 'q7',
                    titleKey: 'q7_title',
                    grammars: [
                        { grammarKey: 'q7_grammar1', descKey: 'q7_desc1', exKeys: ['q7_ex1'] },
                        { grammarKey: 'q7_grammar2', descKey: 'q7_desc2', exKeys: ['q7_ex2'] }
                    ]
                }
            ]
        }
    ];

    document.addEventListener('DOMContentLoaded', () => {
        const mainContent = document.getElementById('main-content');
        const languageSelector = document.getElementById('language-selector');
        const saveButton = document.getElementById('save-button');
        const showResultButton = document.getElementById('show-result-button');
        const saveNotification = document.getElementById('save-notification');

        // Function to build the HTML structure from the pageStructure object
        function buildPage() {
            mainContent.innerHTML = ''; // Clear existing content
            pageStructure.forEach(step => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'mb-12 fade-in';
                
                let stepHTML = `
                    <div class="mb-6 pb-2 border-b-2 border-blue-500">
                        <h2 class="text-2xl font-bold text-gray-700" data-lang-key="${step.titleKey}"></h2>
                        <p class="text-gray-500 mt-1" data-lang-key="${step.descKey}"></p>
                    </div>
                `;
                
                step.questions.forEach(q => {
                    let grammarsHTML = '';
                    q.grammars.forEach(g => {
                        let examplesHTML = g.exKeys.map(exKey => `<li class="mt-1" data-lang-key="${exKey}"></li>`).join('');
                        grammarsHTML += `
                            <div class="mt-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-r-lg">
                                <h4 class="font-semibold text-blue-800" data-lang-key="${g.grammarKey}"></h4>
                                <p class="mt-1 text-gray-600" data-lang-key="${g.descKey}"></p>
                                <ul class="list-disc list-inside mt-2 text-sm text-gray-500 pl-2">${examplesHTML}</ul>
                            </div>
                        `;
                    });

                    stepHTML += `
                        <div class="grammar-card bg-white p-6 rounded-xl shadow-md mb-6">
                            <h3 class="font-bold text-lg" data-lang-key="${q.titleKey}"></h3>
                            ${grammarsHTML}
                            <div class="mt-4">
                                <textarea id="practice-${q.id}" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent transition" rows="4" data-lang-placeholder="practice_placeholder"></textarea>
                            </div>
                        </div>
                    `;
                });
                stepDiv.innerHTML = stepHTML;
                mainContent.appendChild(stepDiv);
            });
        }
        
        // Function to change language
        function changeLanguage(lang) {
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.getAttribute('data-lang-key');
                const isExampleSentence = /^q\d+_ex\d+$/.test(key);

                if (isExampleSentence) {
                    if (translations['ko'] && translations['ko'][key]) {
                        el.innerHTML = translations['ko'][key];
                    }
                } else {
                    if (translations[lang] && translations[lang][key]) {
                        el.innerHTML = translations[lang][key];
                    }
                }
            });
             document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
                const key = el.getAttribute('data-lang-placeholder');
                if (translations[lang] && translations[lang][key]) {
                    el.placeholder = translations[lang][key];
                }
            });
            document.documentElement.lang = lang;
            localStorage.setItem('selectedLanguage', lang);
        }

        // Function to save data
        function saveData() {
            const data = {};
            document.querySelectorAll('textarea[id^="practice-"]').forEach(textarea => {
                data[textarea.id] = textarea.value;
            });
            localStorage.setItem('koreanSpeakingPracticeData', JSON.stringify(data));
            
            saveNotification.classList.remove('hidden');
            setTimeout(() => {
                saveNotification.classList.add('hidden');
            }, 2000);
        }

        // Function to load data
        function loadData() {
            const data = JSON.parse(localStorage.getItem('koreanSpeakingPracticeData'));
            if (data) {
                Object.keys(data).forEach(key => {
                    const textarea = document.getElementById(key);
                    if (textarea) {
                        textarea.value = data[key];
                    }
                });
            }
        }

        // --- Show Results Modal ---
        function showResultScreen() {
            const lang = localStorage.getItem('selectedLanguage') || 'ko';
            let resultsHTML = '';

            pageStructure.forEach(step => {
                step.questions.forEach(q => {
                    const questionText = translations[lang][q.titleKey] || q.titleKey;
                    const answerEl = document.getElementById(`practice-${q.id}`);
                    const answerText = answerEl ? answerEl.value.trim() : '';
                    
                    resultsHTML += `
                        <div class="mb-4 pb-4 border-b border-gray-200">
                            <h3 class="font-bold text-lg text-gray-800">${questionText}</h3>
                            <p class="mt-2 text-blue-600 whitespace-pre-wrap">${answerText || `<i class="text-gray-400">${translations[lang]['no_answer']}</i>`}</p>
                        </div>
                    `;
                });
            });

            const modalOverlay = document.createElement('div');
            modalOverlay.id = 'result-modal-overlay';
            
            modalOverlay.innerHTML = `
                <div id="result-modal" class="fade-in">
                    <header class="flex justify-between items-center p-4 border-b border-gray-200">
                        <h2 class="text-xl font-bold text-gray-800">${translations[lang]['result_title']}</h2>
                        <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button>
                    </header>
                    <main id="result-content" class="flex-1 p-6 overflow-y-auto">
                        ${resultsHTML}
                    </main>
                    <footer class="p-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3">
                         <button id="modal-close-btn-footer" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">${translations[lang]['close_button']}</button>
                         <button id="modal-download-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">${translations[lang]['download_button']}</button>
                    </footer>
                </div>
            `;

            document.body.appendChild(modalOverlay);
            document.body.style.overflow = 'hidden'; // Prevent background scrolling

            const closeModal = () => {
                document.body.removeChild(modalOverlay);
                document.body.style.overflow = 'auto';
            };

            modalOverlay.querySelector('#close-modal-btn').addEventListener('click', closeModal);
            modalOverlay.querySelector('#modal-close-btn-footer').addEventListener('click', closeModal);

            modalOverlay.querySelector('#modal-download-btn').addEventListener('click', downloadResultsAsText);
        }
        
        function downloadResultsAsText() {
            const lang = localStorage.getItem('selectedLanguage') || 'ko';
            let textContent = `${translations[lang]['result_title']}\n====================\n\n`;

            pageStructure.forEach(step => {
                step.questions.forEach(q => {
                    const questionText = translations[lang][q.titleKey] || q.titleKey;
                    const answerEl = document.getElementById(`practice-${q.id}`);
                    const answerText = answerEl ? answerEl.value.trim() : (translations[lang]['no_answer'] || 'No answer');
                    
                    textContent += `${questionText}\n${translations[lang]['answer_label']}: ${answerText}\n\n--------------------\n\n`;
                });
            });

            const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'korean-practice-summary.txt';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }
        
        // Initial setup
        buildPage(); 
        const savedLang = localStorage.getItem('selectedLanguage') || 'ko';
        languageSelector.value = savedLang;
        changeLanguage(savedLang);
        loadData();

        // Event Listeners
        languageSelector.addEventListener('change', (e) => changeLanguage(e.target.value));
        saveButton.addEventListener('click', saveData);
        showResultButton.addEventListener('click', showResultScreen);
    });
</script>
</body>
</html>

