<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>한국어 듣기 퀴즈</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .option-btn {
            transition: all 0.2s;
        }
        .option-btn.correct {
            background-color: #10b981; /* green-500 */
            color: white;
            border-color: #10b981;
        }
        .option-btn.incorrect {
            background-color: #ef4444; /* red-500 */
            color: white;
            border-color: #ef4444;
        }
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        /* Mini Player Styles */
        #mini-player {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        #mini-player.hidden {
            transform: scale(0.8) translateY(-20px);
            opacity: 0;
            pointer-events: none;
        }
        #mini-player-progress {
            transform: rotate(-90deg);
            transform-origin: center;
            transition: stroke-dashoffset 0.1s linear;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-6 sm:p-8">
        <div class="text-center mb-6">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">🎧 한국어 듣기 퀴즈</h1>
            <p class="text-gray-600">듣기 내용을 잘 듣고 질문에 답해 보세요.</p>
        </div>

        <!-- Main Audio Player -->
        <div id="main-audio-player" class="audio-player bg-gray-50 p-4 rounded-lg mb-4">
             <label for="audio-file" class="text-sm font-medium text-gray-700">Track 30 (음원)</label>
             <audio id="audio-file" controls class="w-full mt-2">
                 <source src="./track30.mp3" type="audio/mpeg">
                 Your browser does not support the audio element.
             </audio>
        </div>

        <!-- Script Toggle Button -->
        <div class="mb-6">
            <button id="toggle-script-btn" class="w-full text-left text-indigo-600 font-semibold py-2 px-3 bg-indigo-50 rounded-lg hover:bg-indigo-100 transition">
                <i class="fas fa-file-alt mr-2"></i>스크립트 보기
            </button>
            <div id="script-content" class="hidden mt-3 bg-gray-50 p-4 rounded-lg text-sm space-y-2 border">
                <p><strong>남:</strong> 여러분 안녕하십니까? 건강 상담 시간입니다. 먼저 시청자 한 분의 고민을 들어 보겠습니다.</p>
                <p><strong>여:</strong> 안녕하세요? 저는 인천에 사는 이미지라고 합니다. 백화점에서 판매 일을 하고 있는데요. 계속 서서 일을 했더니 몸이 안 좋아졌어요. 아침에 일어나면 다리가 퉁퉁 붓고 무릎이 아파서 계단을 올라가기도 힘들어요.</p>
                <p><strong>남:</strong> 규칙적으로 운동은 하고 계십니까?</p>
                <p><strong>여:</strong> 직장이 멀어서 집에 돌아오면 밤 10시가 넘어요. 운동할 시간이 없어요.</p>
                <p><strong>남:</strong> 그래도 가장 좋은 방법은 운동입니다. 운동할 시간이 없다면 평소에 발목을 자주 움직여 주고 자기 전에는 누워서 다리를 위로 올리고 가볍게 스트레칭하세요. 다리가 심하게 아플 때는 뜨거운 수건으로 마사지하는 것도 좋습니다.</p>
                <p><strong>여:</strong> 감사합니다. 선생님, 굽이 높은 구두도 다리 건강에 나쁘죠?</p>
                <p><strong>남:</strong> 물론입니다. 하지만 굽이 너무 낮은 구두도 안 좋습니다. 3센티미터 정도가 적당합니다.</p>
                <p><strong>여:</strong> 네, 알겠습니다.</p>
            </div>
        </div>

        <!-- Quiz Container -->
        <div id="quiz-container" class="space-y-8 border-t pt-6">
            <!-- Quizzes are dynamically generated here -->
        </div>
        
        <!-- Result and Action Buttons -->
        <div class="border-t pt-6 text-center mt-6">
             <div id="result-container" class="hidden mb-4">
                 <h2 class="text-2xl font-bold text-green-600">퀴즈 완료!</h2>
                 <p id="score-text" class="text-gray-700 text-lg mt-2"></p>
             </div>
             <button id="submit-btn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition duration-300 w-full sm:w-auto">결과 보기</button>
             <button id="retry-btn" class="hidden bg-gray-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-700 transition duration-300 w-full sm:w-auto">다시 풀기</button>
        </div>
    </div>

    <!-- Mini Audio Player (Sticky) -->
    <div id="mini-player" class="hidden fixed top-4 right-4 bg-white/80 backdrop-blur-sm p-2 rounded-full shadow-lg z-50">
        <div class="relative w-12 h-12">
            <svg class="absolute top-0 left-0 w-full h-full" viewBox="0 0 36 36">
                <circle class="text-gray-200" cx="18" cy="18" r="16" fill="none" stroke-width="3"></circle>
                <circle id="mini-player-progress" class="text-indigo-600"
                    cx="18" cy="18" r="16"
                    fill="none"
                    stroke-width="3"
                    stroke-dasharray="100.5"
                    stroke-dashoffset="100.5" />
            </svg>
            <button id="mini-player-play-pause-btn" class="absolute top-0 left-0 w-full h-full flex items-center justify-center text-indigo-600">
                <i class="fas fa-play text-base"></i>
            </button>
        </div>
    </div>

<script>
    const quizData = [
        {
            question: "여자의 직업은 무엇입니까?",
            options: ["백화점 판매원", "운동선수", "건강 상담사", "회사원"],
            answer: "백화점 판매원"
        },
        {
            question: "여자는 지금 무엇이 가장 힘듭니까?",
            options: ["아침에 일어나는 것", "밤늦게 퇴근하는 것", "계단을 올라가는 것", "높은 구두를 신는 것"],
            answer: "계단을 올라가는 것"
        },
        {
            question: "남자가 제안한 방법이 아닌 것은 무엇입니까?",
            options: ["자기 전에 스트레칭하기", "뜨거운 수건으로 마사지하기", "굽이 아주 낮은 구두 신기", "평소에 발목을 자주 움직이기"],
            answer: "굽이 아주 낮은 구두 신기"
        },
        {
            question: "들은 내용과 같은 것을 고르십시오.",
            options: ["여자는 운동할 시간이 충분합니다.", "남자는 굽이 5cm인 구두를 추천했습니다.", "여자는 아침마다 다리가 붓습니다.", "남자는 여자에게 매일 운동하라고 말했습니다."],
            answer: "여자는 아침마다 다리가 붓습니다."
        }
    ];

    let score = 0;
    let questionsAnswered = 0;

    const quizContainer = document.getElementById('quiz-container');
    const resultContainer = document.getElementById('result-container');
    const scoreText = document.getElementById('score-text');
    const submitBtn = document.getElementById('submit-btn');
    const retryBtn = document.getElementById('retry-btn');
    const toggleScriptBtn = document.getElementById('toggle-script-btn');
    const scriptContent = document.getElementById('script-content');
    
    // Audio Player Elements
    const audio = document.getElementById('audio-file');
    const mainAudioPlayer = document.getElementById('main-audio-player');
    const miniPlayer = document.getElementById('mini-player');
    const miniPlayerPlayPauseBtn = document.getElementById('mini-player-play-pause-btn');
    const miniPlayerProgress = document.getElementById('mini-player-progress');
    const progressCircleRadius = miniPlayerProgress.r.baseVal.value;
    const progressCircumference = 2 * Math.PI * progressCircleRadius;
    miniPlayerProgress.style.strokeDasharray = `${progressCircumference} ${progressCircumference}`;
    miniPlayerProgress.style.strokeDashoffset = progressCircumference;

    function loadAllQuizzes() {
        // ... (quiz loading logic remains the same)
        quizContainer.innerHTML = '';
        quizData.forEach((quiz, index) => {
            const questionBlock = document.createElement('div');
            questionBlock.id = `question-${index}`;
            const questionEl = document.createElement('h2');
            questionEl.className = 'text-xl font-bold text-gray-800 mb-4';
            questionEl.innerText = `Q${index + 1}. ${quiz.question}`;
            const optionsEl = document.createElement('div');
            optionsEl.className = 'grid grid-cols-1 sm:grid-cols-2 gap-3';
            quiz.options.forEach(optionText => {
                const button = document.createElement('button');
                button.innerText = optionText;
                button.classList.add('option-btn', 'w-full', 'p-3', 'text-left', 'border-2', 'rounded-lg', 'hover:bg-gray-100');
                button.addEventListener('click', () => checkAnswer(index, button, optionText, quiz.answer));
                optionsEl.appendChild(button);
            });
            questionBlock.appendChild(questionEl);
            questionBlock.appendChild(optionsEl);
            quizContainer.appendChild(questionBlock);
        });
    }

    function checkAnswer(questionIndex, button, selected, correct) {
        // ... (answer checking logic remains the same)
        const questionBlock = document.getElementById(`question-${questionIndex}`);
        if (questionBlock.dataset.answered) return;
        questionBlock.dataset.answered = 'true';
        questionsAnswered++;
        const optionButtons = questionBlock.querySelectorAll('.option-btn');
        optionButtons.forEach(btn => {
            btn.disabled = true;
            if (btn.innerText === correct) {
                btn.classList.add('correct');
            }
        });
        if (selected === correct) {
            score++;
        } else {
            button.classList.add('incorrect');
        }
    }

    // Event Listeners for buttons
    submitBtn.addEventListener('click', () => {
        if (questionsAnswered < quizData.length) {
            alert('모든 문제를 풀어주세요.');
            return;
        }
        resultContainer.classList.remove('hidden');
        scoreText.innerText = `총 ${quizData.length}문제 중 ${score}문제를 맞혔습니다!`;
        submitBtn.classList.add('hidden');
        retryBtn.classList.remove('hidden');
    });

    retryBtn.addEventListener('click', () => {
        score = 0;
        questionsAnswered = 0;
        resultContainer.classList.add('hidden');
        submitBtn.classList.remove('hidden');
        retryBtn.classList.add('hidden');
        loadAllQuizzes();
    });

    toggleScriptBtn.addEventListener('click', () => {
        scriptContent.classList.toggle('hidden');
        const isHidden = scriptContent.classList.contains('hidden');
        toggleScriptBtn.innerHTML = isHidden ? '<i class="fas fa-file-alt mr-2"></i>스크립트 보기' : '<i class="fas fa-eye-slash mr-2"></i>스크립트 숨기기';
    });
    
    // --- MINI PLAYER LOGIC ---

    // Toggle play/pause on mini player click
    miniPlayerPlayPauseBtn.addEventListener('click', () => {
        if (audio.paused) {
            audio.play();
        } else {
            audio.pause();
        }
    });

    // Sync mini player icon with audio state
    audio.addEventListener('play', () => {
        miniPlayerPlayPauseBtn.innerHTML = '<i class="fas fa-pause text-base"></i>';
    });

    audio.addEventListener('pause', () => {
        miniPlayerPlayPauseBtn.innerHTML = '<i class="fas fa-play text-base"></i>';
    });

    // Update mini player progress circle
    audio.addEventListener('timeupdate', () => {
        const progressPercent = (audio.currentTime / audio.duration) || 0;
        const offset = progressCircumference - progressPercent * progressCircumference;
        miniPlayerProgress.style.strokeDashoffset = offset;
    });

    // Show/hide mini player based on main player visibility
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                miniPlayer.classList.add('hidden');
            } else {
                miniPlayer.classList.remove('hidden');
            }
        });
    }, { threshold: 0.1 }); // Trigger when 10% of the player is visible/hidden

    observer.observe(mainAudioPlayer);

    // Initial load
    loadAllQuizzes();
</script>

</body>
</html>

